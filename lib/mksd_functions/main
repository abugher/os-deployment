#!/bin/bash


function main() {
  get_root
  keep_root &
  keep_root_pid=$!
  get_pass "aaron/${host}/root"
  keep_pass "aaron/${host}/root" &
  keep_pass_pid=$!

  unmount_prep
  safety_net "${card_device}"

  remove_partitions
  write_image
  resize_root_partition
  create_big_partition

  mount_root
  sync_big_partition 
  mount_nonroot

  configure_os

  unmount_nonroot
  unmount_root

  kill_loop "${keep_root_pid}"
  kill_loop "${keep_pass_pid}"
}
